import{u as L,a as V,r as g,o as B,e as N,b as o,c as l,d as e,F as u,f as m,g as $,h,i as F,j as T,n as b,t as w,k,l as y,m as C}from"./index.be4dfebf.js";import{_ as z}from"./pop.6aa7a53b.js";const A={class:"h-screen"},E=T('<div class="mr-2 flex w-3/5 items-center justify-around rounded-lg bg-white"><span class="rounded-lg bg-primary py-1 px-2 text-white"><i class="bx bxs-chevron-left"></i></span><span>1/2</span><span class="rounded-lg bg-primary py-1 px-2 text-white"><i class="bx bxs-chevron-right"></i></span></div>',1),M=e("span",null,"\u5B8C\u6210\u7C3D\u5C6C",-1),U=[M],W=e("div",{class:"mx-auto mb-5 h-[450px] w-11/12 overflow-scroll"},[e("canvas",{id:"canvas"})],-1),X={class:"mx-auto flex w-11/12 justify-around rounded-lg bg-white p-2 text-center text-gray-500"},Y=["onClick"],q={key:0,class:"text-center"},G=e("p",{class:"p-2 text-primary"},"\u8ACB\u9078\u64C7\u7C3D\u540D",-1),O={class:"h-11 w-5/6 rounded-xl bg-white"},J=["onClick","src"],K=["onClick"],Q={class:"p-3 text-start text-primary"},ne={__name:"Contract",setup(Z){const i=L(),P=V(),p=g(""),r=g(!1);i.pdf.url||(p.value="\u672A\u6709\u53EF\u7C3D\u540Dpdf",r.value=!0);const j=()=>{r.value=!1},R=a=>{v.value=a,a==="\u7C3D\u540D"&&(r.value=!0)},v=g(""),S=[{icon:"bxs-edit-alt",title:"\u7C3D\u540D"},{icon:"bx-check",title:"\u52FE\u9078"},{icon:"bx-calendar",title:"\u65E5\u671F"},{icon:"bx-text",title:"\u63D2\u5165\u6587\u5B57"}];let s=null;B(async()=>{pdfjsLib.GlobalWorkerOptions.workerSrc="https://mozilla.github.io/pdf.js/build/pdf.worker.js",s=new fabric.Canvas("canvas"),s.requestRenderAll();const a=atob(i.pdf.url),d=await(await pdfjsLib.getDocument({data:a}).promise).getPage(1),t=d.getViewport({scale:window.devicePixelRatio}),n=document.createElement("canvas"),f=n.getContext("2d");n.height=t.height,n.width=t.width;const I={canvasContext:f,viewport:t};await d.render(I).promise;const _=1/window.devicePixelRatio,x=new fabric.Image(n,{id:"renderPDF",scaleX:_,scaleY:_});s.setWidth(x.width/window.devicePixelRatio),s.setHeight(x.height/window.devicePixelRatio),s.setBackgroundImage(x,s.renderAll.bind(s))});const D=a=>{fabric.Image.fromURL(a,function(c){c.top=400,c.scaleX=.5,c.scaleY=.5,s.add(c),r.value=!1})},H=()=>{const a=s.toDataURL("image/png");i.finalPdf=a,P.push("/save")};return(a,c)=>{const d=N("router-link");return o(),l(u,null,[e("div",A,[e("div",{class:"flex p-4"},[E,e("button",{onClick:H,class:"btn-full w-2/5"},U)]),W,e("div",X,[(o(),l(u,null,m(S,t=>e("div",{key:t.title,onClick:n=>R(t.title),class:b(["rounded-md bg-gray-200 px-3 py-2",{"bg-primary bg-gradient-to-b  from-green-600 to-green-900 text-white":v.value===t.title}])},[e("i",{class:b(["bx",t.icon])},null,2),e("p",null,w(t.title),1)],10,Y)),64))])]),r.value?(o(),$(z,{key:0,closeHandler:j},{default:h(()=>[p.value?(o(),l("div",q,[e("p",null,w(p.value),1),k(d,{class:"btn-full mx-auto block w-2/5",to:"/",replace:""},{default:h(()=>[y("\u78BA\u5B9A")]),_:1})])):(o(),l(u,{key:1},[G,(o(!0),l(u,null,m(C(i).signImg,(t,n)=>(o(),l("div",{key:t,class:"my-2 flex items-center justify-around"},[e("div",O,[e("img",{onClick:f=>D(t),class:"h-full w-full object-contain",src:t,alt:""},null,8,J)]),e("i",{onClick:f=>C(i).deleteSignImg(n),class:"bx bx-trash text-2xl text-primary"},null,8,K)]))),128)),e("p",Q,[k(d,{to:"/sign"},{default:h(()=>[y("+ \u65B0\u589E\u7C3D\u540D")]),_:1})])],64))]),_:1})):F("",!0)],64)}}};export{ne as default};
